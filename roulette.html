<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>$MORI LOTTERY - –†—É–ª–µ—Ç–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Initialize MORI_COIN_BASE64 with undefined to track loading state
        window.MORI_COIN_BASE64 = undefined;
        window.coinImageLoaded = false;
        
        // Load coin image data with improved error handling
        (function() {
            let loadTimeout;
            let retryCount = 0;
            const maxRetries = 3;
            
            function loadCoinScript() {
                const script = document.createElement('script');
                // Use relative path and add cache-busting timestamp
                const scriptPath = 'coin_base64_data.js';
                script.src = scriptPath + '?v=' + Date.now() + '&retry=' + retryCount;
                
                script.onload = function() {
                    clearTimeout(loadTimeout);
                    // Wait a bit for the script to execute
                    setTimeout(function() {
                        if (typeof MORI_COIN_BASE64 !== 'undefined' && MORI_COIN_BASE64) {
                            console.log('coin_base64_data.js loaded successfully');
                            window.coinImageLoaded = true;
                        } else {
                            console.warn('MORI_COIN_BASE64 not defined after script load');
                            if (retryCount < maxRetries) {
                                retryCount++;
                                console.log('Retrying... attempt ' + (retryCount + 1));
                                loadCoinScript();
                            } else {
                                setFallbackImage();
                            }
                        }
                    }, 100);
                };
                
                script.onerror = function() {
                    clearTimeout(loadTimeout);
                    console.error('Failed to load coin_base64_data.js, attempt ' + (retryCount + 1));
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(function() {
                            loadCoinScript();
                        }, 1000);
                    } else {
                        setFallbackImage();
                    }
                };
                
                document.head.appendChild(script);
            }
            
            function setFallbackImage() {
                // Try to use mori-coin.png as fallback
                window.MORI_COIN_BASE64 = 'mori-coin.png';
                window.coinImageLoaded = true;
                console.log('Using fallback image: mori-coin.png');
            }
            
            // Set timeout to detect if script takes too long
            loadTimeout = setTimeout(function() {
                if (typeof MORI_COIN_BASE64 === 'undefined' || !MORI_COIN_BASE64) {
                    console.warn('Timeout loading coin_base64_data.js, using fallback');
                    setFallbackImage();
                }
            }, 10000); // 10 second timeout
            
            // Start loading
            loadCoinScript();
        })();
    </script>
    <link rel="stylesheet" href="roulette.css?v=22">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="header-btn" id="backBtn">‚Üê</button>
            <h1>$MORI LOTTERY</h1>
            <div class="header-btns"></div>
        </div>

        <!-- Roulette Section -->
        <div class="roulette-container">
            <div class="roulette-wrapper">
                <!-- Top indicator arrow -->
                <div class="indicator-arrow top-arrow"></div>
                
                <!-- The roulette with Mori coins -->
                <div class="roulette" id="roulette">
                    <!-- Coins will be generated by JavaScript -->
                </div>
                
                <!-- Bottom indicator arrow -->
                <div class="indicator-arrow bottom-arrow"></div>
            </div>
        </div>

        <!-- Balance and Controls -->
        <div class="controls">
            <div class="coin-info">
                <div class="coin-selector">
                    <span class="coin-name">$Mori Coin</span>
                </div>
                <div class="balance">
                    <span class="balance-label">–≤–∞—à –±–∞–ª–∞–Ω—Å</span>
                    <span class="balance-amount" id="balance">0 $Mori</span>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-auto" id="withdrawBtn">–í—ã–≤–µ—Å—Ç–∏</button>
                <button class="btn btn-spin" id="spinBtn">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–ø–∏–Ω</button>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal" id="resultModal">
            <div class="modal-content">
                <div class="modal-icon">üéâ</div>
                <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
                <p class="prize-amount" id="prizeAmount">100 $Mori</p>
                <p class="prize-text">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!</p>
                <button class="btn btn-close" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="roulette.js?v=24"></script>
</body>
</html>
